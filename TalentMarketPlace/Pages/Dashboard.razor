@page "/dashboard"
@inject IEmployeeService EmployeeService
@inject ISkillService SkillService
@inject IRequirementService RequirementService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudText Typo="Typo.h4" Class="mb-2">HR Dashboard</MudText>
<MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">Overview of your talent pool</MudText>

<!-- Quick Stats -->
<MudGrid>
    <MudItem xs="12" sm="6" md="3">
        <MudCard Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/search-results"))">
            <MudCardContent Class="text-center">
                <MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Large" Color="Color.Primary" />
                <MudText Typo="Typo.h4" Color="Color.Primary">@_totalEmployees</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Total Employees</MudText>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudCard>
            <MudCardContent Class="text-center">
                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Large" Color="Color.Success" />
                <MudText Typo="Typo.h4" Color="Color.Success">@_availableEmployees</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Available</MudText>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudCard>
            <MudCardContent Class="text-center">
                <MudIcon Icon="@Icons.Material.Filled.Code" Size="Size.Large" Color="Color.Info" />
                <MudText Typo="Typo.h4" Color="Color.Info">@_totalSkills</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Skills Tracked</MudText>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudCard Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/application-review"))">
            <MudCardContent Class="text-center">
                <MudIcon Icon="@Icons.Material.Filled.WorkOutline" Size="Size.Large" Color="Color.Warning" />
                <MudText Typo="Typo.h4" Color="Color.Warning">@_openRequirements</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Open Requirements</MudText>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

<MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4"
           OnClick="@(() => Navigation.NavigateTo("/search-results"))"
           StartIcon="@Icons.Material.Filled.Search">
    Search Talent
</MudButton>

@code {
    private int _totalEmployees = 0;
    private int _availableEmployees = 0;
    private int _totalSkills = 0;
    private int _openRequirements = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var employees = await EmployeeService.GetAllAsync();
            _totalEmployees = employees.Count;
            _availableEmployees = employees.Count(e => e.AvailabilityStatus == "Available");

            var skills = await SkillService.GetAllAsync();
            _totalSkills = skills.Count;

            var requirements = await RequirementService.GetAllAsync(true);
            _openRequirements = requirements.Count;
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading data: {ex.Message}", Severity.Error);
        }
    }
}