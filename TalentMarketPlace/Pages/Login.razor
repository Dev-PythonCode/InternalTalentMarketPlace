@page "/login"
@page "/"
@layout EmptyLayout
@inject IAuthService AuthService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudThemeProvider Theme="_theme" />
<MudPopoverProvider/>
<MudDialogProvider />
<MudSnackbarProvider />

<div class="ai-light-wrapper @_selectedRole.ToLower()">


    <!-- LEFT AI PANEL -->
    <div class="ai-light-visual">
        <div class="ai-light-overlay">
            <MudIcon Icon="@Icons.Material.Filled.Psychology"
                     Size="Size.Large"
                     Class="ai-light-icon" />

            <MudText Typo="Typo.h3" Class="ai-light-title">
                One RRD AI
            </MudText>            

            <MudText Typo="Typo.subtitle1" Class="ai-light-subtitle">
                Intelligent Internal Talent Marketplace
            </MudText>

            <MudText Typo="Typo.caption" Class="ai-typing-text mb-3">
                @_aiTypingText
            </MudText>

            <MudText Typo="Typo.body2" Class="ai-light-desc">
                AI-driven skill matching • Career pathways • Talent insights
            </MudText>
        </div>

        <div class="ai-wave"></div>
    </div>

    <!-- LOGIN FORM -->
    <div class="ai-light-form">
        <MudPaper Elevation="4" Class="pa-8 ai-light-card">

            <MudText Typo="Typo.h5" Class="mb-2">
                Welcome!
            </MudText>

            <MudText Typo="Typo.caption" Color="Color.Info" Class="mb-4">
                Sign in to your AI-powered workspace
            </MudText>

            <MudButtonGroup Variant="Variant.Outlined" Class="mb-4" Style="width:100%">
                <MudButton Style="flex:1"
                           Variant="@(_selectedRole=="HR" ? Variant.Filled : Variant.Outlined)"
                           OnClick="@(() => SelectRole("HR"))">
                    HR
                </MudButton>
                <MudButton Style="flex:1"
                           Variant="@(_selectedRole=="Manager" ? Variant.Filled : Variant.Outlined)"
                           OnClick="@(() => SelectRole("Manager"))">
                    Manager
                </MudButton>
                <MudButton Style="flex:1"
                           Variant="@(_selectedRole=="Employee" ? Variant.Filled : Variant.Outlined)"
                           OnClick="@(() => SelectRole("Employee"))">
                    Employee
                </MudButton>
            </MudButtonGroup>

            <MudTextField @bind-Value="_email"
                          Label="Email Address"
                          Variant="Variant.Outlined"
                          FullWidth
                          Class="mb-3" />

            <MudTextField @bind-Value="_password"
                          Label="Password"
                          Variant="Variant.Outlined"
                          InputType="InputType.Password"
                          FullWidth
                          Class="mb-4" />

            <MudButton FullWidth
                       Variant="Variant.Filled"
                       Disabled="@_isLoading"
                       OnClick="HandleLogin"
                       Class="ai-login-btn">
                @if (_isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate Class="mr-2" />
                }
                Sign In
            </MudButton>


            @if (!string.IsNullOrEmpty(_errorMessage))
            {
                <MudAlert Severity="Severity.Error" Class="mt-4">
                    @_errorMessage
                </MudAlert>
            }

        </MudPaper>
    </div>
</div>



@code {
    private string _email = "tech.manager@company.com"; // Default to Manager
    private string _password = "";
    private string _selectedRole = "Manager"; // Default to Manager
    private string _errorMessage = "";
    private bool _isLoading = false;

    private string _aiTypingText = "";
    private readonly string _aiMessage = "Empowering Internal Talents...";
    private int _typingIndex = 0;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await StartTypingEffect();
        }
    }

    private async Task StartTypingEffect()
    {
        while (_typingIndex < _aiMessage.Length)
        {
            _aiTypingText += _aiMessage[_typingIndex];
            _typingIndex++;
            StateHasChanged();
            await Task.Delay(45);
        }
    }

    private MudTheme _theme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#6366f1",
            Secondary = "#8b5cf6"
        }
    };

    private void SelectRole(string role)
    {
        _selectedRole = role;
        UpdateDefaultEmail();
        StateHasChanged();
    }

    private void UpdateDefaultEmail()
    {
        _email = _selectedRole switch
        {
            "HR" => "hr.manager@company.com",
            "Manager" => "tech.manager@company.com",
            "Employee" => "arun.kumar@company.com",
            _ => ""
        };
    }

    private async Task HandleLogin()
    {
        if (string.IsNullOrWhiteSpace(_email))
        {
            _errorMessage = "Please enter your email address";
            return;
        }

        _isLoading = true;
        _errorMessage = "";

        try
        {
            var result = await AuthService.LoginAsync(_email, _password);

            if (result.Success)
            {
                Snackbar.Add($"Welcome back, {result.Employee?.FullName ?? "User"}!", Severity.Success);
                
                var redirectUrl = result.User?.Role switch
                {
                    "HR" => "/dashboard",
                    "Manager" => "/dashboard",
                    "Employee" => "/job-board",
                    _ => "/dashboard"
                };

                Navigation.NavigateTo(redirectUrl, true);
            }
            else
            {
                _errorMessage = result.Error ?? "Invalid credentials";
            }
        }
        catch (Exception ex)
        {
            _errorMessage = "An error occurred during login";
            Console.WriteLine($"Login error: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }
}

<style>

    .ai-login-btn {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #a8f163, #066c12);
        color: white;
    }

        .ai-login-btn::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient( 120deg, transparent, rgba(255,255,255,0.4), transparent );
            animation: shimmer 2.5s infinite;
        }
    @@keyframes shimmer {
        0% {
            left: -100%;
        }

        100% {
            left: 100%;
        }
    }

    /* Role-based AI accent */
    .hr .ai-light-icon,
    .hr .ai-login-btn {
        color: #7c3aed;
    }

    .manager .ai-light-icon
    {
        color: #6082eb;
    }
    .manager .ai-login-btn {
        color: #ebecef;
    }

    .employee .ai-light-icon,
    .employee .ai-login-btn {
        color: #059669;
    }

    .ai-light-wrapper {
        display: flex;
        min-height: 100vh;
        background: #f8fafc;
    }

    /* LEFT PANEL */
    .ai-light-visual {
        flex: 1.1;
        position: relative;
        background: linear-gradient(135deg, #e0e7ff, #f0f9ff);
    }

    .ai-light-overlay {
        padding: 80px 60px;
    }

    .ai-light-icon {
        color: #4f46e5;
        font-size: 56px;
    }

    .ai-light-title {
        font-weight: 700;
        margin-top: 12px;
    }

    .ai-light-subtitle {
        opacity: 0.85;
    }

    .ai-light-desc {
        margin-top: 16px;
        color: #475569;
    }

    /* AI WAVE */
    .ai-wave {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 200px;
        background: url('/images/ai-wave.svg') no-repeat bottom;
        background-size: cover;
    }

    /* LOGIN FORM */
    .ai-light-form {
        flex: 0.9;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ai-light-card {
        width: 100%;
        max-width: 420px;
        border-radius: 16px;
        background: white;
    }

    /* MOBILE */
    @@media (max-width: 900px) {
        .ai-light-visual {
            display: none;
        }
    }

    .ai-wave {
        animation: waveFloat 6s ease-in-out infinite;
    }

    @@keyframes waveFloat {
        0%, 100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(8px);
        }
    }

</style>